angular.module("authController",[]).controller("authController",function($scope,$location,Auth){"use strict";$scope.formData={},$scope.login=function(){$.isEmptyObject($scope.formData)||Auth.login($scope.formData).success(function(data){$scope.formData={},console.log("auth controller: "+data)}).error(function(data){console.log("Error: "+data)}).then(function(){$location.url("/profile")})}}),angular.module("todoController",[]).controller("mainController",function($scope,$http,Auth,Todos){"use strict";if($scope.formData={},Auth.verifyUser()){var token=$http.defaults.headers.common.Authorization;console.log(token),Todos.get("/api/todos").success(function(data){$scope.todos=data}).error(function(data){console.log("Error: "+data)})}$scope.createTodo=function(){$.isEmptyObject($scope.formData)||Todos.create($scope.formData).success(function(data){$scope.formData={},$scope.todos=data}).error(function(data){console.log("Error: "+data)})},$scope.deleteTodo=function(id){Todos.delete(id).success(function(data){$scope.todos=data}).error(function(data){console.log("Error: "+data)})}}),angular.module("todoApp",["ngCookies","ngResource","authService","todoController","todoService"]),angular.module("authApp",["ngCookies","ngResource","authController","authService"]),angular.module("authService",[]).factory("Auth",function($http,$q,$cookies){"use strict";return{login:function(userData){return console.log(userData),$http.post("/login",userData).success(function(result){console.log("auth service: "+result.user),$http.defaults.headers.common.Authorization=["Bearer ",result.user.token].join(""),$cookies.auth_token=result.user.token,console.log("Authentication header and cookie set.")})},verifyUser:function(){{var token=$cookies.auth_token;$q.defer()}return token?(console.log("User is already authenticated."),$http.defaults.headers.common.Authorization=["Bearer ",token].join(""),!0):!1}}}),angular.module("todoService",[]).factory("Todos",function($http){return{get:function(){return $http.get("/api/todos")},create:function(todoData){return $http.post("/api/todos",todoData)},"delete":function(id){return $http.delete("/api/todos/"+id)}}});